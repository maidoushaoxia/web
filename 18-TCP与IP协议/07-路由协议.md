## 07-路由控制

### 7.1 路由控制的定义

1. 静态路由与动态路由
   - 静态路由：事先设置好路由器和主机并将路由信息固定
   - 动态路由：路由协议在运行过程中自动地设置路由控制信息
2. 动态路由的基础：路由器给相邻路由器发送自己已知的网络连接信息，依次传递下去，直至整个网络都了解。

### 7.2 路由控制范围

1. 自治系统与路由协议：自治系统内部动态路由采用的协议是域内路由协议IGP，自治系统之间的路由控制采用的是域间路由协议EGP
2. IGP与EGP：根据EGP在区域网络之间路由选择，根据IGP在区域网络内部进行主机识别。

### 7.3 路由算法

1. 距离向量算法：根据距离和方向决定目标网络或目标主机位置，此算法不容易判断每个路由器上的信息是否正确。如RIP、RIP2、EGP等协议。
2. 链路状态算法：所有路由器持有相同的信息，即使网络复杂，每个路由器也能保持正确的路由信息，主要路由协议进行稳定的路由选择。如OSPF。

### 7.4 RIP(Routing Information Protocol)

1. 广播路由控制信息：RIP将路由控制信息30秒一次向全网广播，若等了6次（180秒）仍未收到路由控制信息，连接就断开。
2. 根据距离向量确定路由：根据距离向量生成距离向量表，再选择距离较短的路径生成最终的路由控制表。
3. 使用子网掩码时的RIP处理
   - 从接口的IP地址分类得出网络地址后，与流过路由器的包的IP地址比较，如果两者网络地址相同，就以接口的网络地址长度为准
   - 如果两者的网络地址不同，就以包的IP地址的分类所确定的网络地址长度为准
4. RIP中路由变更时的处理
   - 无限计数：收到自己发出去的消息
     - 可以控制最长距离不超过16
     - 规定路由器不再把所收到的路由消息原路返回给发送端
   - 有环路的情况下
     - 毒性逆转：网络中发生链路被断开时，将这个无法通信的消息传播出去
     - 触发更新：路由信息发生变化时，不等待30秒，而是立刻发送出去，从而避免错误路由信息被不断发送
5. RIP2
   - 使用多播
   - 支持子网掩码
   - 路由选择域
   - 外部路由标志
   - 身份验证密钥

### 7.5 OSPF(Open Shortest Path First)

1. 链路状态型路由协议：路由器之间交换链路状态生成网络拓扑信息，然后根据这个拓扑信息生成路由控制表。OSPF给每条链路赋予一个权重，始终选择一个权重最小的路径作为最终路由。
2. OSPF基础知识：根据作用的不同分为5种类型的包
   - 问候HELLO：确认相邻路由器、确定指定路由器
   - 数据库描述Database Description：链路状态数据库的摘要信息
   - 链路状态请求Link State Request：请求从数据库中获取链路状态信息
   - 链路状态更新Link State Update：更新链路状态数据库中的链路状态信息
   - 链路状态确认应答Link State Acknowledge：链路状态更新的确认应答
3. OSPF工作原理概述：
   - LAN每10秒发送一个HELLO包，若没有HELLO包到达，则进行连接是否断开的判断，路由器发送一个链路状态更新包通知其他路由器网络状态的变化
   - 链路状态更新包消息有网络LSA和路由LSA
   - 这样每个路由器生成一个可以表示网络结构的链路状态数据库，采用最短路径优先算法生成相应的路由控制表
4. 区域分层化
   - 边界路由器：连接区域与主干区域的路由器
   - 内部路由器：区域内部的路由器
   - 主干路由器：至于主干区域内连接的路由器
   - AS边界路由器：与外部相连接的路由器

### 7.6 BGP(Border Gateway Protocol)

1. BGP与AS号：BGP根据自治系统的AS号进行相应的路由控制
2. BGP是路径向量协议：根据要经过的路径信息访问列表进行路由控制的协议
   - BGP扬声器：根据BGP交换路由控制信息的路由器

### 7.7 MPLS（Multi Protocol Label Switching）

- 标记交换：对每个IP包设定一个”标记“，再根据这个标记进行转发

1. 网络基本动作：MPLS中目标地址和数据包都要通过由标记决定的同一路径叫做标记交换路径LSP，LSP属于单方向的通路
2. MPLS优点：
   - 转发速度快
   - 利用标记生成虚拟的路径，并实现IP等数据包的通信