## 05-IP协议相关技术

### 5.1 DNS

1. DNS：当用户输入主机名时，DNS会自动检索注册了主机名和IP地址的数据库，并迅速定位对应的IP地址。
2. 域名的构成：在主机后面追加组织结构的域名
   - 域名服务器：指管理域名的主机和软件，每个域的分层上都有各自的域名服务器，DNS根据IP地址进行检索时，是从根域名服务器开始往下进行
   - 解析器：进行DNS查询的主机和软件，个人电脑就属于解析器
3. DNS查询：
   - 解析器向DNS服务器查询IP地址
   - 接收查询请求的DNS服务器首先在自己的数据查找，如果有该域名对应的IP地址就返回，没有则向上一层根域名服务器查询，直到找到指定的域名服务器，并返回想要的数据
   - 解析器和域名服务器将其保存在缓存里

### 5.2 ARP

1. 概要：是解决地址问题的协议，以目标IP地址为线索，用来定位下一个应该接收数据分包的网路设备的MAC地址。若目标主机不在同一链路上，可以通过ARP查找下一跳路由器的MAC地址。
2. 工作机制：从一个IP地址发送ARP请求包（广播发送）以了解其MAC地址，目标地址将自己的MAC地址填入其中的ARP响应包，返回到IP地址。
3. IP地址和MAC地址缺一不可：
   - 若主机A经过路由器C发送数据报给主机B，由于路由器会隔断两个网络，主机A必须先发送给路由器C的MAC地址
   - 仅凭MAC地址，人们无法知道机器的位置
4. RARP：是将ARP反过来，从MAC地址定位到IP地址的协议。如打印机等嵌入式设备，由于没有输入接口无法通过DHCP公太获取IP地址，需要使用一台RARP服务器，在这个服务器上注册设备的MAC地址及其IP地址。
5. 代理ARP：通常ARP包会被路由器隔离，采用代理ARP的路由器可以将ARP请求转发给邻近的网段，这样可以像在同一网段中一样进行通信。

### 5.3 ICMP

1. 功能：确认IP包是否成功送达目标地址，通知在发送过程中IP包被废弃的具体原因，改善网络设置等。
2. 主要的ICMP消息
   - ICMP目标不可达消息（类型3）
     - 错误代码1：主机不可达，指路由表中没有该主机的信息，或者该主机未联网
     - 错误代码4：用于MTU探索
   - ICMP重定向消息（类型5）：路由器发现有更好的路由信息时，发送此消息给发送端主机，该消息中包含最合适的路由信息和源数据
   - ICMP超时消息（类型11）：IP包的TTL值减到0时，该IP包会被丢弃，此时IP路由器发送一个ICMP超时的消息给发送端主机，通知该包已丢弃。这是为了避免IP包无休止地在网络上被转发
   - ICMP回送消息（类型0、8）：判断所发送的数据包是否已成功到达对端，如ping。可以向对端发送回送请求的消息（类型8），接收对端主机发回的回送应答消息（类型0）
3. 其他ICMP消息
   - ICMP原点抑制消息（类型4）：缓和路由器网络拥堵问题
   - ICMP路由器探索消息（类型9、10）：用于发现与自己相连网络中的路由器
   - ICMP地址掩码消息（类型17、18）：用于主机或路由器想要了解子网掩码的情况
4. ICMPv6
   - 作用：没有ICMpv6，IPv6就无法正常通信
   - 邻居探索：用于查询IPv6的地址与MAC地址的对应关系，并向邻居宣告消息得知MAC地址，邻居请求消息利用IPv6的多播地址实现传输

### 5.4 DHCP

1. 即插即用：自动设置IP地址、统一管理IP地址分配，计算机只要联网，就可以进行TCP/IP通信
2. 工作机制：
   - 要求设置IP地址和子网掩码
   - 通知可以使用的网络设置
   - 通知想要使用上一步中的设置
   - 通知允许设置
3. DHCP中继代理：不同网段的IP地址分配可以由一个DHCP服务器统一管理
   - DHCP客户端向DHCP中继代理发送DHCP请求包，DHCP中继代理在收到广播包后以单播的形式发送给DHCP服务器，服务器收到该包以后再向DHCP中继代理返回应答，并由DHCP中继代理将此包转发给DHCP客户端。

