## 02-TCP/IP 基础知识

### 2.1 TCP/IP 协议分层模型

1. 硬件（物理层）
2. 网络接口层（数据链路层）
3. 互联网层（网络层）
   - IP协议：使用IP地址作为主机的标识，不具有重发机制，属于非可靠性传输协议
   - ICMP协议：IP数据包发送异常时，给发送端发送包一个发生异常的通知
   - ARP协议：从分组数据包的IP地址中解析出MAC地址的一种协议

4. 传输层
   - TCP协议：面向有连接的，能够处理丢包、传输顺序乱等异常情况
   - UDP协议：面向无连接的

5. 应用层（会话层以上）
   - WWW：HTTP属于应用层，HTML属于表示层
   - SMTP：电子邮件的协议
   - FTP：文件传输
   - TELNET与SSH：远程登录
   - SNMP：网络管理

### 2.2 TCP/IP分层模型与通信

1. 数据包首部：每个分层都会对所发送的数据附加一个首部，该首部表明协议应该如何读取数据
2. 发送数据包（TCP/IP 通信过程）
   - 应用程序处理：在发送邮件的那一刻建立TCP连接
   - TCP模块处理：TCP负责建立连接、发送数据以及断开连接。在应用层数据前附加一个TCP首部，包括源端口号和目标端口号、序号以及校验和，然后将附加了TCP首部的包发送给IP
   - IP 模块处理：IP在TCP首部前加上IP首部，包括接收端IP地址和发送端IP地址，以及用来判断后面数据是TCP还是UDP的信息，然后参考路由控制表，IP包被发送出去
   - 网络接口处理：将IP包加上以太网首部，包括接收端MAC地址、发送端MAC地址以及标志以太网类型的以太网数据的协议，同时在包的最后（包尾）添加FCS（判断数据包是否被破坏），然后物理层将以太网数据包传输给接收端
3. 经过数据链路的包：每个包首部包含发送端和接收端的地址，以及上一层的协议类型
4. 数据包接收处理：是发送流程的逆序过程
   - 网络接口处理：主机收到以太网包后，首先从首部找MAC地址判断是否为发给自己包，不是则丢弃数据，如果是就查找以太网包首部中的类型域确定以太网协议传送过来的数据类型（IP、ARP等），然后将数据传输给对应的处理程序
   - IP模块处理：判断包首部的IP地址是否与自己的IP地址匹配，接收数据并查找上一层的协议（TCP或UDP），然后借助路由控制表，将IP包首部之后的部分传给TCP处理
   - TCP模块处理：首先计算检验和，判断数据是否被破坏，然后检查是否按照序号接收数据，最后检查端口号，确定具体的应用程序。数据接收完毕，接收端会发送一个确认回执给发送端
   - 应用程序处理：接收端应用程序直接接收发送端发送的数据，如果一切正常，则返回一个处理正常的绘制给发送端，否则发送处理异常的回执。