# 《JavaScript高级程序设计》读书笔记 #


## 第十六章 HTML5脚本编程 ##

---------------------
### 16.1 跨文档消息传递(XDM) ###
- 指的是在来自不同域的页面间传递消息,

- 核心是postMessage()方法:能向另一个地方(包含在当前页面中的`<iframe>`元素或者由当前页面弹出的窗口)传递数据.接收一条消息字符串和表示消息接收方来自哪个域的字符串.

- 接收XDM消息时,会触发window对象的message事件,此事件是异步的,因此可能会有延迟.触发message事件后,传递给onMessage处理程序的事件对象包含:
  - data:传入的字符串数据;
  - origin:发送消息的文档所在域;
  - source:发送消息的文档的window对象的代理.此代理对象主要用于在发送上一条消息的窗口调用postMessage()方法.如果发送消息的窗口来自同一个域,那此对象就是window.

### 16.2 原生拖放 ###
1. 拖放事件
  - 拖动某元素时,将依次触发下列事件:
    - dragstart;
    - drag;
    - dragend.

  - 当某个元素被拖放到一个有效的放置目标上时,会触发下列事件:
    - dragenter;
    - dragover;
    - dragleave 或drop.

2. 定义放置目标
  - 可以重写dragenter和dragover事件默认行为,将不允许放置的元素变为有效的放置目标.

3. dataTransfer对象
  - 是事件对象的一个属性,用于从被拖动元素向放置目标传递字符串格式的数据.主要有两个方法:
    - setData():第一个参数是数据类型,第二个参数是要传递的数据.在拖动文本框的文本时,会保存拖动的文本,,而在拖动链接或图像时,会保存链接l.
    - getData():只接受一个字符串,表示保存的数据类型,取值为"text"或"URL".在元素被拖动到放置目标时,就调用此方法.

  - 保存在dataTransfer中的数据只能在drop事件处理程序中读取,如果没有读取到,那dataTransfer对象已经被销毁了.数据也丢失了.

4. dropEffect与dropAllowed
  - dropEffect属性:在ondragenter事件处理程序设置,可以知道被拖动的元素能够执行哪种放置行为,有四个值:
    - "none":不能把拖动的元素放在这里;
    - "move":应该把拖动的元素移动到放置目标;
    - "copy":应该把拖动的元素复制到放置目标;
    - "link":表示放置目标会打开拖动的元素(但拖动元素必须的一个链接,有URL).

  - dropAllowed属性:必须在ondragstart事件处理程序中设置,表示允许拖动元素的哪种dropEffect.
    - "copylink"
    - "copymove"
    - "linkmove"

5. 可拖动
  - draggable属性:表示元素是否可以拖动.图像和链接的默认值为true,其他元素的默认值为false.

6. 其他成员
  - addElement
  - clearData
  - setDragImage
  - types
    
### 16.3 媒体元素 ###
- `<audio>`元素:嵌入音频.
- `<video>`元素:嵌入视频.
----------
1. 属性

2. 事件

3. 自定义媒体播放器:
  - 给`<video>`元素的load事件处理程序,设置了加载完视频后显示播放事件.

  - 给按钮添加一个事件处理程序,单击它能让视频在暂停时播放,在播放时暂停.

  - 设置一个定时器,以更新当前显示的事件.

4. 检测编解码器的支持情况
  - 通过惨PlayType()方法,该方法接收一个格式/编解码器字符串,返回"probably","maybe"或"".

5. Audio类型
  - 只要创建一个新实例,并传入音频源文件即可.
    - 创建新的Audio实例即可开始下载指定的文件,下载完成后,调用paly()即可播放音频.
    - 如果想在一个音频结束后再播放另一个音频,必须在onfinish事件处理程序中调用play()方法.

### 16.4 历史状态管理 ###
- 通过history对象的状态管理,能够在不刷新页面的情况下改变浏览器的URL.

- 可以使用pushState()方法:接收状态对象(应提供初始化页面状态所需的各种信息),新状态的标题(一般传入"")和相对URL(可选的).执行此方法后,新的状态信息就会被加入历史状态栈,浏览器地址栏也会变成新的相对地址.但浏览器**不会向服务器发送请求**.

- 按下后退按钮,会触发window对象的popstate事件,此事件对象有一个state属性,这个属性就包含着当初传给pushState()的状态对象.

- 可以使用replaceState()方法更新当前状态.传递的参数就是pushState()方法的前两个参数.调用这个方法不会再历史状态栈中创建新状态,只会重写当前状态.


