# 《JavaScript高级程序设计》读书笔记 #


## 第二十一章 Ajax与Comet ##

---------------------
### 21.1 XMLHTTPRequest ###
  - 创建XHR对象:
    ```JavaScript
    var xhr = new XMLHttpRequest();
    ```
------------------

1. XHR的用法
  - 首先调用open()方法:接收三个参数,要发送的请求类型("get","post"等),请求的URL和是否异步发送的布尔值.
    - URL相对于执行代码的当前页面,只能向同一个域中使用相同端口和协议的URL发送请求(同源策略).
    - 调用open()方法并不会真正发送请求,只是启动一个请求以备发送.

  - 要发送请求,必须调用send()方法:接收一个参数,即要作为请求主题发送的数据.如果不需要通过请求主体发送数据,则传入null.此时请求就会被分派到服务器.
    - 此次请求是**同步的**,js代码会等服务器响应后再继续执行.

  - 收到响应后,响应的数据会自动填充XHR对象的属性:
    - responseText:作为响应主体被返回的文本;
    - responseXML:如果响应的内容类型是"text/xml"或"application/xml",该属性保存包含响应数据的XMLDOM文档;
    - status:响应的HTTP状态;
    - statusText:HTTP状态的说明.

  - 接收到响应后,第一步是检查status属性,以确定响应已经成功返回.HTTP状态码为200说明成功了.状态码为304表示请求的资源没有被修改,可以直接使用浏览器的缓存版本.

  - 检测XHR对象的readyState属性,该属性表示请求/响应过程的当前活动阶段:
    - 0:未初始化:尚未调用open()方法.
    - 1:启动,已经调用open()方法,还未调用send()方法.
    - 2:发送,已经调用send()方法,但尚未接收到响应.
    - 3:接收:已经接收到部分响应数据.
    - 4:完成:已经接收到全部响应数据,且可以在客户端使用了.

  只要readyState属性的值变化,就会触发一次readystatechange事件.

  - 在接收到响应前还可以调用abort()方法来取消异步请求.终止请求后,还应该对XHR对象进行解引用操作.
