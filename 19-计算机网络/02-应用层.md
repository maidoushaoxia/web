## 02-应用层

### 2.1 应用层的原理

1. 网络应用的结构：
   - CS结构：由客户端和一直在线的服务端构成，如Web、FTP、elent、e-mail
     - 为了跟上所有客户端的请求，通常采用一个数据中心来创建虚拟服务端
   - P2P结构：不需要服务端
2. 进程通信
   - 两个不同终端系统上的进程通过计算机网络来交换消息，发送进程创建并向网络发送消息；接收进程接收这些消息，并可能通过将消息发回来进行响应
   - 客户端：发起通信的进程
   - 服务端：等待被联系从而开始会话的进程
   - 进程与计算机网络之间的接口：在主机架的应用层与传输层之间，也被称为应用程序与网络之间的API
   - 地址进程：需要确认两个信息
     - 目标主机地址：用IP地址来识别
     - 接收进程：用端口号来区分主机上运行多个进程
3. 传输层协议可以提供的服务从四个维度来划分
   - 可靠的数据传输：保证不丢包
     - 类似多媒体的等容错应用，可以不提供可靠的数据传输服务
   - 吞吐量：发送进程将比特传送到接收进程的速率
     - 带宽敏感应用：对吞吐量有要求，需要保证吞吐量是一个固定值
     - 弹性应用：利用尽可能多的吞吐量
   - 耗时：保证每个比特能够在规定时间内到达接收进程，多媒体应用需要
   - 安全性：加密等
4. 传输层服务
   - TCP服务模型：
     - 面向连接的服务：用三次握手
     - 可靠的数据传输服务
       - 安全套接字（SSL）：
         - 发送进程将明文数据传输到SSL的套接字；
         - 发送主机中的SSL对数据进行加密，并将加密的数据传递到TCP套接字；
         - 接收套接字将加密的数据传递给SSL，然后SSL对数据进行解密；
         - 最后，SSL将明文数据通过其SSL套接字传递给接收进程
   - UDP服务模型
     - 无连接
     - 不可靠的
5. 应用层协议：定义了一个应用进程如何在不同终端系统上运行，并相互传递消息。

### 2.2 网络与HTTP

1. HTTP：超文本传输协议
   - 客户端与服务端通过交换HTTP消息来交流，HTTP定义了这些消息的结构以及客户端与服务端如何交换消息
   - 大多数网页由一个基本的HTML文件以及一些引用对象（图片等）组成，HTML文件URL来引用其他对象
   - URL由两部分组成：
     - 存放对象的服务器的主机名
     - 对象的路径名
   - HTTP使用TCP作为底层传输协议
   - **无状态协议**：服务器发送请求文件给客户端时，不存储任何客户端相关的信息
2. 非持久与持久连接
   - 非持久连接是每次传递消息都要发起不同的TCP连接
     - 三次握手：总的响应时间 = 两次往返时间 + HTML文件传输时间
   - 持久连接可以不用每次都花费两次往返时间
3. HTTP报文格式
   - 请求报文：
     - 请求行：包含请求方法，URL地址，HTTP版本
     - 请求头部：包含主机地址，是否持久连接，浏览器，语言等信息
     - 空行
     - 请求主体：用于POST请求，GET请求时为空
   - 响应报文：
     - 状态行
     - 响应头部：包含连接信息、日期、服务器信息、资源上一次修改的时间、内容长度以及类型等信息
     - 空行
     - 响应主体
4. Cookie：包含四个部分
   - HTTP响应报文中的cookie头部信息
   - HTTP请求报文中的cookie头部信息
   - cookie文件保留在用户的终端系统，并由用户的浏览器进行管理
   - 网站的后端数据库
5. 网络缓存
   - 是一个代理服务器，浏览器请求时会先请求网络缓存：
     - 浏览器与网络缓存建立TCP连接，并向其发送HTTP请求；
     - 网络缓存检查是否有本地存储的副本，如果有，则将请求的对象放在HTTP响应报文中，发送给客户端浏览器；
     - 若网络缓存中不存在该对象，则与源服务器建立连接，并发送HTTP请求，源服务器接收到请求后，将请求的对象放在HTTP响应报文中，发送给网络缓存；
     - 网络缓存接收到对象后，会在本地存储一个副本，并通过已存在的TCP连接发送给客户端浏览器
   - 条件GET：让缓存验证其存储的对象是最新的，当满足以下两个条件时的HTTP请求报文被称为条件GET报文
     - 请求报文适用了GET方法
     - 请求头部中包含If-Modified-Since行



