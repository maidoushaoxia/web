# 《Vue.js》读书笔记 #


## 第7章  组件详解##
----------
### 7.1 组件与复用 ###
1. 为什么使用组件：
  - 组件是提高重用性，让代码可复用。

2. 组件用法：
- 全局注册：
  ```JavaScript
  Vue.component('my-component',{
    //在组件选项中添加template：
    template:'<div>这里是组件的内容</div>'
  });
  ```

- 局部注册：使用components选项局部注册组件，注册后的组件只有在该实例作用域下有效。

- data使用：
  - 必须是函数，然后将数据return出去。
  - 如果return出的对象引用了外部的一个对象，那这个对象就是共享的，任何一方修改都会同步。如果返回的是一个新的对象，则组件之间互不影响，就可以达到复用的效果。

### 7.2 使用props传递数据 ###
1. 基本用法：
- 父组件正向地向子组件传递数据或参数，子组件接收到后根据参数的不同来渲染不同的内容或执行操作，这个正向传数据的过程就是通过props来实现的。(demo1)

- 使用v-bind动态绑定props的值，当父组件的数据变化时，也会传递给子组件。(demo2)

- 如果直接传递数字、布尔值、数组、对象，且不使用v-bind，则传递的仅仅是字符串。

2. 单向数据流
- 父组件数据变化时会传递给子组件，但反过来不行。

- 两种改变props的方法：
  - 父组件传递初始值进来，子组件将它作为初始值保存起来，在自己的作用域下可以随意使用和修改。这种情况可以在组件data内再声明一个数据，引用父组件的prop。
  - prop作为需要被改变的原始值传入，此时可以使用计算属性。(如加“px")

- 对象和数组是引用类型，指向同一个内存空间，因此props是对象或数组时，子组件的改变也会影响父组件。

3. 数据验证：如某个数据必须是数字类型，如果传入字符串，就会在控制台弹出警告。

### 7.3 组件通信 ###
1. 自定义事件：用于子组件向父组件传递数据。(demo3)
- 观察者模式：子组件用$emit()里触发事件，父组件用$on()来监听子组件的事件。

-父组件也可以直接在子组件的自定义标签上使用v-on来监听子组件触发的自定义事件。

2. 使用v-model
- 可以用来创建自定义的表单输入组件，进行数据双向绑定(demo4)。此时需要满足两个要求：
  - 接收一个value属性(props)；
  - 在有新的value时触发input事件($emit)。

3. 非父子组件通信
- Vue.js 2.x中，使用一个空的Vue实例作为中央事件总线(demo5)。

- 父链：在子组件中，使用this.$parent可以直接访问该组件的父实例或组件。父组件也可以通过this.$children访问它所有的子组件。但是这样使得父子组件耦合。

- 子组件索引：在父组件模板中，子组件标签上使用ref指定一个名称，并在父组件内通过this.$refs来访问指定名称的子组件。

### 7.4 使用slot分发内容 ###
1. 什么是slot：当需要让组件组合使用，混合父组件的内容与子组件的模板时，需要用到slot，这个过程叫内容分发。
- Vue的组件都是由props传递数据、events触发事件和slot内容分发这3部分构成的。

2. 作用域
- 父组件模板的内容在父组件作用域内编译，子组件木板的内容在子组件作用域内编译。因此，slot分发的内容，作用域是在父组件上的。

3. slot用法
- 单个Slot：在子组件内使用`<slot>`元素可以为此子组件开启一个插槽，在父组件模板里，插入在子组件标签内的所有内容将替代子组件的`<slot>`标签及它的内容。子组件的模板内定义的`<slot>`元素，如果父组件没有使用slot，则渲染此默认显示内容；如果写入了slot，则会替换整个`<slot>`。

- 具名Slot：给`<slot>`元素指定一个name后可以分发多个内容。在子组件中，没有使用name特性的`<slot>`元素将作为默认slot出现，父组件没有使用slot特性的元素与内容都将出现在这里。如果子组件内没有指定默认的匿名slot，父组件内多余的内容片段都将被抛弃。

4. 作用域插槽
- `<slot>`元素可以用`msg="xxx"`来传递数据给插槽，父组件的临时变量`scope="props"`能够访问来自子组件插槽的数据msg:`props.msg`。

- 还可以允许组件自定义应该如何渲染列表每一项。

5. 访问slot
- 通过$slots可以访问某个具名slot(`this.$slots.header`)，`this.$slots.default`包括了所有没包含在具名slot中的节点。

### 7.5 组件高级用法 ###
1. 递归组件
- 只要给组件设置name，就可以在组件的模板内递归调用自己。但是要给一个条件来限制递归数量，否则会抛出错误。

2. 内联模板
- 给组件标签使用`inline-template`特性，组件就会把它的内容当做模板，而不是当做内容分发。

3. 动态组件
- 通过`<component>`元素来动态地挂载不同的组件，使用is特性来选择要挂载的组件。

4. 异步组件
- Vue.js可以将组件定义为一个工厂寒素，动态地解析组件。只在组件需要渲染时触发工厂函数，并将结果缓存起来，用于后面的再次渲染。

### 7.6 其他 ###
1. $nextTick
- 异步更新队列：Vue在观察到数据变化时，不是直接更新DOM，而是开启一个队列，并缓冲在同一事件循环中发生的所有数据改变。在下一个事件循环tick中，Vue刷新队列并执行实际工作。

2. X-Templates
- 在`<script>`标签里使用text/x-template类型，并指定一个id，将这个id赋给template。则可以不用拼接字符串来写模板。

3. 手动挂载实例
- Vue.extend:基础Vue构造器，创建一个”子类“，参数是一个包含组件选项的对象。

- $mount:如果Vue实例在实例化时没有收到el选项，则处于未挂载状态。可以使用$mount()手动的挂载一个未挂载的实例。
